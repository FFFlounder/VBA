'设置超链接
Private Sub CommandButton1_Click()
    Dim IPAdress As String
    Dim RowStart As String
    Dim RowEnd As String
    Dim i As Integer
    
    Dim x As String
    
    RowStart = InputBox("请输入起始行号:")
    RowEnd = InputBox("请输入结束行号:")
    
    For i = RowStart To RowEnd
    
        x = "F" & i
        IPAddress = GetIP(i)
        If Right(IPAdress, 1) <> "\" Then
            ActiveSheet.Hyperlinks.Add Anchor:=Range(x), Address:=IPAddress
        End If

    Next
    
End Sub


'复制件毛体,TOTAL金额
Private Sub CommandButton2_Click()

    Dim Wb1 As Workbook
    Dim Wb2 As Workbook
    Dim Temp As String
    Dim RowStart As String
    Dim RowEnd As String
    Dim i As Integer
    Dim Location1 As Range
    Dim Location2 As Range
    
    Dim x As String
    Dim y As String
    
    RowStart = InputBox("请输入起始行号:")
    RowEnd = InputBox("请输入结束行号:")
    
    Content1 = "TOTAL"
    Content2 = "Package:"

    
    Set Wb1 = ThisWorkbook
    
    For i = RowStart To RowEnd
    
       ' x = "F" & i
        Temp = GetIP(i)
        
        '判断路径是否是正确路径
        If Right(Temp, 1) <> "\" Then
            Set Wb2 = GetObject(Temp)
            
            
            Set Location1 = Wb2.Sheets("INV").Range("B:B")
            Set Location2 = Wb2.Sheets("PAK").Range("B:B")
            
            x = FindRow(Temp, Content1, Location1)
            y = FindRow(Temp, Content2, Location2)
            
            '复制数据按工作表名称
            Wb1.Sheets("FY18 NEW").Range("G" & i) = Wb2.Sheets("INV").Range("I" & x)
            
            Wb1.Sheets("FY18 NEW").Range("V" & i) = Left(Wb2.Sheets("PAK").Range("C" & y), 1)
            Wb1.Sheets("FY18 NEW").Range("W" & i) = Wb2.Sheets("PAK").Range("C" & y - 2)
            Wb1.Sheets("FY18 NEW").Range("X" & i) = Wb2.Sheets("PAK").Range("C" & y - 1)
                       
            Wb2.Close False
        End If
    Next
        
End Sub




'提取K106089 INV&PAK 表格文件位置
Function GetIP(i)
    Dim Temp As String
    Dim Tc As String
    Dim K As String
    
    Set Wb1 = ThisWorkbook
    Tc = Wb1.Sheets("FY18 NEW").Range("E" & i).Value
    K = Wb1.Sheets("FY18 NEW").Range("F" & i).Value
    Z = Wb1.Sheets("FY18 NEW").Range("BG" & i).Value
    
    'BUG定死的路径Temp = ThisWorkbook.Path & "\FY18 15W" & "\E1804-1276S-GIT K106098 HW-03 海运" & "\K106098  INV&PAK-E1804-1276S-GIT.xls"
    Temp3 = Dir(Wb1.Path & "\FY18 " & Z & "*W", vbDirectory)                              'FY18 15W
    Temp2 = Dir(Wb1.Path & "\" & Temp3 & "\" & Tc & "*", vbDirectory)                     'E1804-1276S-GIT K106098 HW-03 海运
    Temp1 = Dir(Wb1.Path & "\" & Temp3 & "\" & Temp2 & "\" & K & "*INV&PAK" & "*.xls")    'K106098  INV&PAK-E1804-1276S-GIT.xls
    

    '完整路径
    Temp = Wb1.Path & "\" & Temp3 & "\" & Temp2 & "\" & Temp1
    GetIP = Temp

End Function




'旧!  在INV&PAK中找到Package:行号，便于动态复制
Function FindW(Temp)
    Dim W As String
    Set Wb2 = GetObject(Temp)
    Dim FindString As String
    FindString = "Package:"
    Dim Rng As Range
    
        '查找行号，没有的话跳过或者跳警告
        With Wb2.Sheets("PAK").Range("B:B")
            Set Rng = .Find(What:=FindString, _
                        After:=.Cells(.Cells.Count), _
                        LookIn:=xlValues, _
                        LookAt:=xlWhole, _
                        SearchOrder:=xlByRows, _
                        SearchDirection:=xlNext, _
                        MatchCase:=False)
            If Not Rng Is Nothing Then
                W = Rng.Row
            Else
                MsgBox "没有找到!"
            End If
        End With
    FindW = W
End Function




'新  在INV&PAK中 动态查找工作表，表中位置，便于动态复制
Function FindRow(Temp, Content, Location)
    Dim R As String
    Set Wb2 = GetObject(Temp)
   
    Dim Rng As Range
    
        '查找行号，没有的话跳过或者跳警告
        With Location
            Set Rng = .Find(What:=Content, _
                        After:=.Cells(.Cells.Count), _
                        LookIn:=xlValues, _
                        LookAt:=xlWhole, _
                        SearchOrder:=xlByRows, _
                        SearchDirection:=xlNext, _
                        MatchCase:=False)
            If Not Rng Is Nothing Then
                R = Rng.Row
            Else
                MsgBox "没有找到!"
            End If
        End With
    FindRow = R
End Function
